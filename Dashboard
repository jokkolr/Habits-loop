<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HabitLoop - Recovery Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f5f9;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1, h2 { color: #222; font-size: 1.5em; }
    select, button {
      padding: 10px;
      margin: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 1em;
      cursor: pointer;
      max-width: 90%;
    }
    button {
      background: #00796b;
      color: white;
      border: none;
    }
    button:hover { background: #004d40; }
    .plan-box, .journal-box, .quote-box {
      background: white;
      padding: 15px;
      margin: 15px auto;
      border-radius: 8px;
      max-width: 600px;
      text-align: left;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      width: 90%;
    }
    .plan-box { background: #fff3cd; }
    .quote-box { background: #e3f2fd; font-style: italic; color: #1565c0; text-align: center; }
    textarea {
      width: 100%;
      height: 80px;
      margin-top: 5px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      resize: none;
    }

    /* Risk Modal */
    #riskModal, #galleryModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      overflow: auto;
    }
    #riskModalContent, #galleryModal > div {
      background: white;
      width: 90%;
      max-width: 500px;
      margin: 50px auto;
      padding: 15px;
      border-radius: 10px;
      text-align: left;
    }
    #riskModalContent.warning {
      background: #330000;
      color: #ffdddd;
      border: 2px solid red;
    }
    #riskModalContent h2 { color: #b71c1c; font-size: 1.3em; }
    #riskModalContent.warning h2 { color: #ff4444; }
    .blurred {
      filter: blur(8px);
      transition: filter 0.3s;
      max-width: 100%;
      margin: 10px 0;
    }
    .blurred.revealed { filter: blur(0); }

    /* Clarewell Gallery iframe */
    #galleryModal iframe {
      width: 100%; 
      height: 80vh;
      border: none;
    }
    #galleryModal button {
      position: absolute;
      top: 10px; right: 10px;
      background: red; color: white;
      padding: 8px 12px;
      border: none; border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
    }

    /* Mobile Optimizations */
    @media (max-width: 600px) {
      h1, h2 { font-size: 1.2em; }
      select, button { font-size: 0.9em; padding: 8px; }
      .plan-box, .journal-box, .quote-box { width: 95%; padding: 10px; }
      #riskModalContent, #galleryModal > div { width: 95%; margin: 30px auto; }
      #galleryModal iframe { height: 70vh; }
    }
  </style>
</head>
<body>
  <h1>Welcome, <span id="username"></span>!</h1>
  <h2>Select an Addiction for a Personalized Recovery Plan</h2>

  <select id="addictionSelect" onchange="showPlan()">
    <option value="drugs">Drugs</option>
    <option value="alcohol">Alcohol</option>
    <option value="porn">Porn</option>
    <option value="gambling">Gambling</option>
    <option value="phone">Phone Overuse</option>
    <option value="smoking">Smoking</option>
    <option value="riskySex">Risky Sexual Behaviors</option>
  </select>

  <div class="quote-box" id="dailyQuote"></div>
  <div class="plan-box" id="planBox"></div>

  <!-- Risk Modal -->
  <div id="riskModal">
    <div id="riskModalContent">
      <h2>⚠ Think Before You Risk It</h2>
      <div id="riskContent"></div>
      <button onclick="toggleWarningMode()" id="toggleModeBtn">Show Warning Mode (Visual)</button>
      <button onclick="openGallery()">See Real STI Images</button>
      <button onclick="proceedAnyway()">Proceed Anyway</button>
      <button onclick="closeRiskModal()">Close</button>
    </div>
  </div>

  <!-- Clarewell Gallery Popup -->
  <div id="galleryModal">
    <div>
      <iframe src="https://clarewellclinics.co.uk/sti/symptoms/pictures/"></iframe>
      <button onclick="closeGallery()">Close</button>
    </div>
  </div>

  <div class="journal-box">
    <h3>Your Daily Journal</h3>
    <textarea id="journalText" placeholder="How are you feeling today? What did you achieve?"></textarea>
    <button onclick="saveJournal()">Save Entry</button>
  </div>

  <script>
    const user = localStorage.getItem('habitloopUser') || "Friend";
    document.getElementById('username').innerText = user;

    const quotes = [
      "Small habits every day create big change.",
      "Each day is a new chance to start fresh.",
      "Progress, not perfection, leads to success.",
      "You are stronger than your urges.",
      "Your future self will thank you for today."
    ];

    const plans = {
      drugs: [
        { step: "Clear Your Space", detail: "Remove all drugs and tools linked to usage." },
        { step: "Avoid Triggers", detail: "Stop visiting places and people connected to your drug use." },
        { step: "Replacement Habits", detail: "Start a hobby, exercise, or volunteer to replace old routines." },
        { step: "Seek Support", detail: "Join a support group or talk to a mentor regularly." },
        { step: "Track Progress", detail: "Write down your wins daily, no matter how small." }
      ],
      porn: [
        { step: "Use Blockers", detail: `Install:
          <br>- <a href="https://getcoldturkey.com" target="_blank">Cold Turkey</a>
          <br>- <a href="https://cleanbrowsing.org/filters/adult" target="_blank">CleanBrowsing DNS</a>
          <br>- <a href="https://blocksite.co/" target="_blank">BlockSite (Android/iOS)</a>` },
        { step: "Control Devices", detail: "Keep phones and laptops out of your bedroom at night." },
        { step: "Replace Urges", detail: "Go for a walk, read, or exercise when cravings hit." },
        { step: "Social Time", detail: "Spend time outdoors or with friends to break isolation." },
        { step: "Reflect Daily", detail: "Journal each night and celebrate milestones weekly." }
      ]
    };

    function showPlan() {
      const addiction = document.getElementById('addictionSelect').value;
      if (addiction === 'riskySex') { openRiskModal(); return; }
      const plan = plans[addiction] || [];
      const html = plan.map(step => `<details><summary>${step.step}</summary><p>${step.detail}</p></details>`).join('');
      document.getElementById('planBox').innerHTML = `<h3>${capitalize(addiction)} Recovery Plan</h3>${html}`;
      showQuote(); loadJournal();
    }

    function showQuote() {
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById('dailyQuote').innerText = `"${quote}"`;
    }

    function saveJournal() {
      const addiction = document.getElementById('addictionSelect').value;
      localStorage.setItem(`${addiction}Journal`, document.getElementById('journalText').value);
      alert("Journal saved!");
    }

    function loadJournal() {
      const addiction = document.getElementById('addictionSelect').value;
      document.getElementById('journalText').value = localStorage.getItem(`${addiction}Journal`) || "";
    }

    function capitalize(str) { return str.charAt(0).toUpperCase() + str.slice(1); }

    // Risky Sexual Behaviors Logic
    function openRiskModal() { document.getElementById("riskModal").style.display = "block"; resetToProfessionalMode(); }
    function closeRiskModal() { document.getElementById("riskModal").style.display = "none"; }
    function toggleWarningMode() {
      const modal = document.getElementById('riskModalContent');
      const content = document.getElementById('riskContent');
      const btn = document.getElementById('toggleModeBtn');
      if (!modal.classList.contains('warning')) {
        modal.classList.add('warning');
        content.innerHTML = `
          <h3 style="color:#ff9999;">WARNING MODE</h3>
          <p>Risky sex can lead to <strong>painful, life-changing infections</strong>.  
          Real medical images (click to reveal):</p>
          <img src="https://www.mayoclinic.org/-/media/kcms/gbs/patient-consumer/images/2016/10/13/12/55/stds-sls-20076923-0015-10-1.jpg" class="blurred" id="stiImage" alt="STI Example">
          <p><small>Tap the image to unblur (graphic content)</small></p>
          <ul>
            <li>⚠ Over <strong>1 million STIs</strong> acquired daily (WHO)</li>
            <li>⚠ Some cause <strong>infertility or lifelong issues</strong></li>
            <li>⚠ Treatment is <strong>costly and stressful</strong></li>
          </ul>`;
        btn.textContent = "Switch to Professional Mode";
        document.getElementById('stiImage').onclick = function() { this.classList.toggle('revealed'); };
      } else { resetToProfessionalMode(); }
    }
    function resetToProfessionalMode() {
      const modal = document.getElementById('riskModalContent');
      const content = document.getElementById('riskContent');
      const btn = document.getElementById('toggleModeBtn');
      modal.classList.remove('warning');
      content.innerHTML = `
        <p>Unprotected or risky sexual behavior can lead to <strong>serious infections and lifelong consequences</strong>.  
        Protect yourself — or at least <strong>know the risks before deciding.</strong></p>
        <h3>Learn the Facts</h3>
        <ul>
          <li><a href="https://www.mayoclinic.org/diseases-conditions/sexually-transmitted-diseases-stds/multimedia/stds/sls-20076923" target="_blank">Mayo Clinic (Images)</a></li>
          <li><button onclick="openGallery()" style="background:red; color:white; padding:5px 10px; border:none; border-radius:5px;">See Clarewell STI Gallery</button></li>
        </ul>`;
      btn.textContent = "Show Warning Mode (Visual)";
    }
    function proceedAnyway() {
      document.getElementById('planBox').innerHTML = `
        <h3>Risk Reduction Plan</h3>
        <p>If you still choose to engage, use <strong>protection every time</strong>, get tested regularly, and avoid multiple partners.</p>`;
      closeRiskModal();
    }

    // Clarewell Gallery Controls
    function openGallery() { document.getElementById('galleryModal').style.display = 'block'; }
    function closeGallery() { document.getElementById('galleryModal').style.display = 'none'; }

    showPlan();
  </script>
</body>
</html>
